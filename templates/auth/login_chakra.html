{% extends "base_chakra.html" %}

{% block title %}Login - BuyRoll{% endblock %}

{% block content %}
<div style="min-height: calc(100vh - 4rem); display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--chakra-colors-green-50), var(--chakra-colors-blue-50)); padding: var(--chakra-space-8) var(--chakra-space-4);">
    <div class="chakra-card" style="width: 100%; max-width: 28rem; padding: var(--chakra-space-8);">
        <!-- Header -->
        <div class="chakra-text-center chakra-mb-8">
            <div style="width: 4rem; height: 4rem; background: linear-gradient(135deg, var(--chakra-colors-green-400), var(--chakra-colors-blue-400)); border-radius: var(--chakra-radii-xl); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--chakra-space-4);">
                <i class="fas fa-shopping-bag" style="color: white; font-size: 1.5rem;"></i>
            </div>
            <h1 class="chakra-heading" style="font-size: 2rem; margin-bottom: var(--chakra-space-2);">Welcome Back</h1>
            <p class="chakra-text" style="font-size: 1.125rem;">Sign in to your BuyRoll account</p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div style="padding: var(--chakra-space-4); border-radius: var(--chakra-radii-lg); margin-bottom: var(--chakra-space-6); 
                    {% if category == 'error' %}
                        background: #FED7D7; color: #C53030; border: 1px solid #FEB2B2;
                    {% elif category == 'success' %}
                        background: #C6F6D5; color: #2F855A; border: 1px solid #9AE6B4;
                    {% else %}
                        background: #BEE3F8; color: #2B77CB; border: 1px solid #90CDF4;
                    {% endif %}">
                    <div class="chakra-flex chakra-items-center">
                        <i class="fas fa-{% if category == 'error' %}exclamation-circle{% elif category == 'success' %}check-circle{% else %}info-circle{% endif %}" style="margin-right: var(--chakra-space-2);"></i>
                        {{ message }}
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Login Form -->
        <form method="POST" action="{{ url_for('auth.login') }}">
            {{ form.hidden_tag() if form }}
            
            <!-- Email Field -->
            <div class="chakra-mb-6">
                <label for="email" style="display: block; font-weight: 600; color: var(--chakra-colors-gray-700); margin-bottom: var(--chakra-space-2);">
                    <i class="fas fa-envelope" style="margin-right: var(--chakra-space-2); color: var(--chakra-colors-gray-500);"></i>
                    Email Address
                </label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    class="chakra-input" 
                    placeholder="Enter your email address"
                    required
                    style="font-size: 1rem;"
                    value="{{ form.email.data if form and form.email.data else '' }}"
                >
                {% if form and form.email.errors %}
                    {% for error in form.email.errors %}
                    <p style="color: var(--chakra-colors-red-500); font-size: 0.875rem; margin-top: var(--chakra-space-1);">
                        <i class="fas fa-exclamation-triangle" style="margin-right: var(--chakra-space-1);"></i>{{ error }}
                    </p>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Password Field -->
            <div class="chakra-mb-6">
                <label for="password" style="display: block; font-weight: 600; color: var(--chakra-colors-gray-700); margin-bottom: var(--chakra-space-2);">
                    <i class="fas fa-lock" style="margin-right: var(--chakra-space-2); color: var(--chakra-colors-gray-500);"></i>
                    Password
                </label>
                <div style="position: relative;">
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="chakra-input" 
                        placeholder="Enter your password"
                        required
                        style="font-size: 1rem; padding-right: 3rem;"
                    >
                    <button 
                        type="button" 
                        onclick="togglePassword()" 
                        style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--chakra-colors-gray-500); cursor: pointer; padding: 0.25rem;"
                    >
                        <i class="fas fa-eye" id="password-toggle-icon"></i>
                    </button>
                </div>
                {% if form and form.password.errors %}
                    {% for error in form.password.errors %}
                    <p style="color: var(--chakra-colors-red-500); font-size: 0.875rem; margin-top: var(--chakra-space-1);">
                        <i class="fas fa-exclamation-triangle" style="margin-right: var(--chakra-space-1);"></i>{{ error }}
                    </p>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- Remember Me & Forgot Password -->
            <div class="chakra-flex chakra-items-center chakra-justify-between chakra-mb-6">
                <label class="chakra-flex chakra-items-center" style="cursor: pointer;">
                    <input type="checkbox" name="remember_me" style="margin-right: var(--chakra-space-2); accent-color: var(--chakra-colors-green-500);">
                    <span style="font-size: 0.875rem; color: var(--chakra-colors-gray-600);">Remember me</span>
                </label>
                <a href="#" style="font-size: 0.875rem; color: var(--chakra-colors-green-600); text-decoration: none; font-weight: 500;">
                    Forgot password?
                </a>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="chakra-button chakra-button-solid chakra-w-full" style="font-size: 1.125rem; height: 3rem; margin-bottom: var(--chakra-space-6);">
                <i class="fas fa-sign-in-alt" style="margin-right: var(--chakra-space-2);"></i>
                Sign In
            </button>
        </form>

        <!-- Divider -->
        <div style="position: relative; margin: var(--chakra-space-6) 0;">
            <div style="position: absolute; inset: 0; display: flex; align-items: center;">
                <div style="width: 100%; border-top: 1px solid var(--chakra-colors-gray-200);"></div>
            </div>
            <div style="position: relative; display: flex; justify-content: center; font-size: 0.875rem;">
                <span style="background: white; padding: 0 var(--chakra-space-4); color: var(--chakra-colors-gray-500);">Or continue with</span>
            </div>
        </div>

        <!-- Social Login -->
        <div class="chakra-grid chakra-grid-cols-2 chakra-gap-4 chakra-mb-6">
            <button type="button" class="chakra-button chakra-button-outline" style="justify-content: center;">
                <i class="fab fa-google" style="margin-right: var(--chakra-space-2); color: #DB4437;"></i>
                Google
            </button>
            <button type="button" class="chakra-button chakra-button-outline" style="justify-content: center;">
                <i class="fab fa-facebook" style="margin-right: var(--chakra-space-2); color: #4267B2;"></i>
                Facebook
            </button>
        </div>

        <!-- Sign Up Link -->
        <div class="chakra-text-center">
            <p style="color: var(--chakra-colors-gray-600);">
                Don't have an account? 
                <a href="{{ url_for('auth.register') }}" style="color: var(--chakra-colors-green-600); text-decoration: none; font-weight: 600;">
                    Sign up here
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('password-toggle-icon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.className = 'fas fa-eye-slash';
        } else {
            passwordInput.type = 'password';
            toggleIcon.className = 'fas fa-eye';
        }
    }

    // Auto-focus first input
    document.addEventListener('DOMContentLoaded', function() {
        const firstInput = document.getElementById('username');
        if (firstInput) {
            firstInput.focus();
        }
    });

    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        if (!username) {
            e.preventDefault();
            alert('Please enter your username or email');
            return;
        }

        if (!password) {
            e.preventDefault();
            alert('Please enter your password');
            return;
        }

        // Show loading state
        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>Signing In...';
        submitButton.disabled = true;

        // Re-enable button after 5 seconds (in case of network issues)
        setTimeout(() => {
            submitButton.innerHTML = originalText;
            submitButton.disabled = false;
        }, 5000);
    });
</script>
{% endblock %}